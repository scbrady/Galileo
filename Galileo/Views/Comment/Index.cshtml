@model Galileo.ViewModels.Comments

@section styles {
    @Styles.Render("~/Content/selectize")
}

@{
    ViewBag.Title = "Home Page";
}

@foreach (var comment in Model.comments)
{
    <div class="comment chat sent">
        <h4><strong>To:</strong> Firstname Lastname</h4>
        <h4 class="comment-from"><strong>From:</strong> Firstname Lastname</h4>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur sed neque eu ligula dictum interdum id ut nulla. Proin elementum ut dolor eu cursus. Sed laoreet ex bibendum, eleifend odio et, interdum est. Duis porta elit a lacus ultricies, ac convallis tortor tempor. In facilisis tortor sit amet diam maximus porta. Nulla finibus magna ac risus pellentesque vestibulum. Quisque vel imperdiet mauris, vestibulum ultricies quam. Nullam sed elit odio.</p>
        <em class="pull-right"><strong>sent at:</strong> 12:00am mm-dd-yy</em>
    </div>

    <div class="comment">
        <h4><strong>To:</strong> @comment.recipient_id / <strong>From:</strong> @comment.commenter_id / <strong>At:</strong> @comment.created_at</h4>
        <p>@comment.comment_text</p>
    </div>
}

@using (Html.BeginForm("Create", "Comment", FormMethod.Post, new { id = "comment-form" }))
{
    @Html.AntiForgeryToken()

    @Html.HiddenFor(m => m.commenter_id)

    @Html.LabelFor(m => m.recipients)<br />
    @Html.TextBoxFor(m => m.recipients, new { id = "recipients"});

    @Html.LabelFor(m => m.comment)<br />
    @Html.TextAreaFor(m => m.comment)<br />

    <input type="submit" value="Submit">
}

@section scripts {
    @Scripts.Render("~/bundles/selectize")

    <script>
        $(function () {
            $('#recipients').selectize({
                delimeter: ',',
                persist: false,
                maxOptions: 5,
                closeAfterSelect: true,
                valueField: 'user_id',
                labelField: 'user_first_name',
                searchField: ['user_first_name', 'user_first_name', 'user_id'],
                preload: true,
                render: {
                    item: function (item, escape) {
                        return '<div>' +
                            (item.user_first_name ? '<span class="selectize-user-name">' + escape(item.user_first_name) + ' ' + escape(item.user_last_name) + '</span>' : '') +
                            (item.user_id ? '<span class="selectize-user-id">&lt;' + escape(item.user_id) + '&gt;</span>' : '') +
                        '</div>';
                    },
                    option: function (item, escape) {
                        var label = item.user_first_name + ' ' + item.user_last_name;
                        var caption = item.user_id;
                        return '<div>' +
                            '<span class="selectize-label">' + escape(label) + '</span>' +
                            '<span class="selectize-caption">' + escape(caption) + '</span>' +
                        '</div>';
                    }
                },
                load: function (query, callback) {
                    if (!query.length) return callback();

                    $.ajax({
                        url: '@Url.Content("~")Comment/Users',
                        dataType: 'json',
                        success: function (data) {
                            callback(data);
                        }
                    });
                }
            });
        });
    </script>
}