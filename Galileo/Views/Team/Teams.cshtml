@model Galileo.ViewModels.CourseProjectsAndUsers

@{
    ViewBag.Title = "Project Page";
}

<h3>Projects</h3>
@using (Html.BeginForm("Create", "Team", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    <ul data-project-index="0" class="connected sortable list"><h3>Project Manager</h3></ul>
    <input type="hidden" name="teams[0].userIds" value="" />
    for (int index = 1; index < Model.projects.Count; index++)
    {
        <ul data-project-index="@index" class="connected sortable list"><h3>@Model.projects[index].project_name</h3></ul>
        <input type="hidden" name="teams[@index].projectId" value="@Model.projects[index].project_id" />
        <input type="hidden" name="teams[@index].userIds" value="" />
    }
    <input type="submit" value="Submit">
}

<h3>Users</h3>
<ul class="connected sortable list">
    @foreach (var user in Model.users)
    {
        <li id="@user.user_id">@user.user_first_name @user.user_last_name</li>
    }
</ul>

@section scripts {
    @Scripts.Render("~/bundles/jquerysort")

    <script>
		    $(function() {
			    $('.sortable').sortable({
				    connectWith: '.connected'
			    });

			    $('.sortable').sortable().bind('sortupdate', function (e, ui) {
			        var start_index = ui.startparent.data('project-index');
			        var end_index = ui.endparent.data('project-index');

			        var student_ids = '';
			        ui.endparent.find( "li" ).each(function (i, li) {
			            var user_id = $(li).attr('id');
			            student_ids = student_ids + (!student_ids ? '' : ',') + user_id;
			        });
			        $('[name="teams[' + end_index + '].userIds"]').val(student_ids);

			        if (typeof start_index != 'undefined')
			        {
			            student_ids = '';
			            ui.startparent.find("li").each(function (i, li) {
			                var user_id = $(li).attr('id');
			                student_ids = student_ids + (!student_ids ? '' : ',') + user_id;
			            });
			            $('[name="teams[' + start_index + '].userIds"]').val(student_ids);
			        }
			    });
		    });
    </script>
}